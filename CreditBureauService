package com.example.creditbureau.service;

import com.example.creditbureau.entity.CreditCardBureau;
import com.example.creditbureau.repository.CreditCardBureauRepository;
import com.example.creditbureau.utils.ExcelGeneratorUtil;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import java.io.IOException;
import java.time.LocalDateTime;

@Service
public class CreditCardBureauService {

    @Autowired
    private CreditCardBureauRepository repository;

    @Autowired
    private DataSynthesisService dataSynth;

    @Autowired
    private ExcelGeneratorUtil excelUtil;

    private static final String BASE_PATH = "C:/Documents/pdffiles/";

    public CreditCardBureau generateCustomerData(String customerId) throws IOException {
        String paymentFile = BASE_PATH + customerId + "_payment_history.xlsx";
        String utilisationFile = BASE_PATH + customerId + "_limit_utilisation.xlsx";

        excelUtil.generatePaymentHistoryExcel(paymentFile);
        excelUtil.generateLimitUtilisationExcel(utilisationFile);

        CreditCardBureau bureau = new CreditCardBureau();
        bureau.setCustomerId(customerId);
        bureau.setCreditScore(dataSynth.generateRandomInt(650, 900));
        bureau.setPaymentHistoryFilepath(paymentFile);
        bureau.setLimitUtilisationFilepath(utilisationFile);
        bureau.setAllottedCreditLimit(dataSynth.generateRandomDouble(50000, 200000));
        bureau.setUpdatedOn(LocalDateTime.now());

        return repository.save(bureau);
    }
}